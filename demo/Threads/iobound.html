<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I/O vs CPU Bound Tasks: Thread Selection Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        h1, h2 {
            color: #4a5568;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cpu-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
            justify-items: center;
        }

        .cpu-core {
            width: 180px;
            height: 200px;
            border: 3px solid #4299e1;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: linear-gradient(145deg, #e2e8f0, #cbd5e0);
            box-shadow: 5px 5px 10px #a0aec0, -5px -5px 10px #ffffff;
        }

        .core-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .thread-slot {
            width: 90%;
            height: 35px;
            margin: 2px 0;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            transition: all 0.5s ease;
            background: #f7fafc;
        }

        .thread-running {
            background: linear-gradient(45deg, #ff6b6b, #e74c3c);
            color: white;
            border-color: #e74c3c;
            animation: cpuWork 2s infinite;
        }

        .thread-ready {
            background: linear-gradient(45deg, #4ecdc4, #48bb78);
            color: white;
            border-color: #48bb78;
            animation: ready 2s infinite;
        }

        .thread-blocked {
            background: linear-gradient(45deg, #fed7d7, #feb2b2);
            color: #c53030;
            border-color: #c53030;
            animation: ioWait 3s infinite;
        }

        .thread-context-switch {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: white;
            border-color: #f59e0b;
            animation: contextSwitch 0.5s infinite;
        }

        @keyframes cpuWork {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.9; }
        }

        @keyframes ready {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        @keyframes ioWait {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes contextSwitch {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        .demo-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            background: #f7fafc;
        }

        .control-panel {
            text-align: center;
            margin: 30px 0;
        }

        .btn {
            padding: 12px 20px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cpu {
            background: linear-gradient(45deg, #ff6b6b, #e74c3c);
            color: white;
        }

        .btn-io {
            background: linear-gradient(45deg, #4ecdc4, #48bb78);
            color: white;
        }

        .btn-context {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .explanation {
            background: #edf2f7;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #4299e1;
        }

        .comparison-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .comparison-box {
            padding: 25px;
            border-radius: 15px;
            text-align: left;
        }

        .cpu-bound-box {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border: 3px solid #e74c3c;
        }

        .io-bound-box {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            border: 3px solid #48bb78;
        }

        .context-switch-box {
            background: linear-gradient(135deg, #fef3cd, #fde68a);
            border: 3px solid #f59e0b;
        }

        .timeline {
            display: flex;
            align-items: center;
            margin: 10px 0;
            min-height: 35px;
        }

        .timeline-label {
            width: 100px;
            font-weight: bold;
            text-align: right;
            margin-right: 15px;
            font-size: 0.9em;
        }

        .time-slots {
            display: flex;
            flex: 1;
            overflow-x: auto;
        }

        .time-slot {
            min-width: 30px;
            height: 25px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            margin-right: 1px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4299e1;
        }

        .performance-meter {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .performance-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 2s ease;
        }

        .good-performance {
            background: linear-gradient(90deg, #48bb78, #38a169);
        }

        .poor-performance {
            background: linear-gradient(90deg, #f56565, #e53e3e);
        }

        .medium-performance {
            background: linear-gradient(90deg, #ed8936, #dd6b20);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .thread-count-display {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            border: 2px solid #ffc107;
        }

        .thread-count-display h3 {
            margin: 0;
            color: #856404;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üîÑ I/O vs CPU Bound Tasks: Thread Selection</h1>
    <p style="text-align: center; font-size: 1.2em; color: #666;">Understanding Thread Optimization for Different Workloads</p>
</div>

<div class="container">
    <h2>üñ•Ô∏è CPU Cores and Thread Management</h2>

    <div class="cpu-container">
        <div class="cpu-core">
            <div class="core-title">Core 1</div>
            <div class="thread-slot" id="core1-thread1">T1</div>
            <div class="thread-slot" id="core1-thread2">T2</div>
            <div class="thread-slot" id="core1-thread3">T3</div>
            <div class="thread-slot" id="core1-thread4">T4</div>
        </div>

        <div class="cpu-core">
            <div class="core-title">Core 2</div>
            <div class="thread-slot" id="core2-thread1">T5</div>
            <div class="thread-slot" id="core2-thread2">T6</div>
            <div class="thread-slot" id="core2-thread3">T7</div>
            <div class="thread-slot" id="core2-thread4">T8</div>
        </div>

        <div class="cpu-core">
            <div class="core-title">Core 3</div>
            <div class="thread-slot" id="core3-thread1">T9</div>
            <div class="thread-slot" id="core3-thread2">T10</div>
            <div class="thread-slot" id="core3-thread3">T11</div>
            <div class="thread-slot" id="core3-thread4">T12</div>
        </div>

        <div class="cpu-core">
            <div class="core-title">Core 4</div>
            <div class="thread-slot" id="core4-thread1">T13</div>
            <div class="thread-slot" id="core4-thread2">T14</div>
            <div class="thread-slot" id="core4-thread3">T15</div>
            <div class="thread-slot" id="core4-thread4">T16</div>
        </div>
    </div>

    <div class="thread-count-display" id="threadCountDisplay" style="display: none;">
        <h3 id="totalThreadCount">Total Threads: 0</h3>
        <p>Only 16 threads shown visually above (representing the massive queue)</p>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(45deg, #ff6b6b, #e74c3c);"></div>
            <span>Running (On CPU Core)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(45deg, #4ecdc4, #48bb78);"></div>
            <span>Ready (Waiting for CPU)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(45deg, #fed7d7, #feb2b2);"></div>
            <span>Blocked (Waiting for I/O)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(45deg, #fbbf24, #f59e0b);"></div>
            <span>Context Switching</span>
        </div>
    </div>

    <div class="control-panel">
        <button class="btn btn-cpu" onclick="demonstrateCPUBound()">CPU-Bound Tasks (4 Threads)</button>
        <button class="btn btn-io" onclick="demonstrateIOBound()">I/O-Bound Tasks (16 Threads)</button>
        <button class="btn btn-context" onclick="demonstrateContextSwitching()">Context Switching Overhead (200 Threads!)</button>
        <button class="btn" style="background: #gray;" onclick="resetDemo()">Reset</button>
    </div>

    <div class="stats-container">
        <div class="stat-box">
            <div class="stat-value" id="runningThreads">0</div>
            <div>Running Threads</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="readyThreads">0</div>
            <div>Ready Threads</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="blockedThreads">0</div>
            <div>Blocked Threads</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="cpuUtilization">0%</div>
            <div>CPU Utilization</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="contextSwitches">0</div>
            <div>Context Switches/sec</div>
        </div>
    </div>

    <div style="margin: 20px 0;">
        <h4>System Performance:</h4>
        <div class="performance-meter">
            <div class="performance-bar good-performance" id="performanceBar" style="width: 0%;"></div>
        </div>
    </div>
</div>

<div class="container">
    <div class="comparison-container">
        <div class="comparison-box cpu-bound-box">
            <h3>üî• CPU-Bound Tasks</h3>
            <h4>Characteristics:</h4>
            <ul>
                <li>Heavy mathematical calculations</li>
                <li>Image/video processing</li>
                <li>Cryptographic operations</li>
                <li>Data compression</li>
                <li>Scientific computations</li>
            </ul>
            <h4>Thread Strategy:</h4>
            <p><strong>Optimal: 1 thread per CPU core</strong></p>
            <p>More threads = more context switching overhead</p>
            <p>Example: 4 cores = 4 threads maximum</p>
        </div>

        <div class="comparison-box io-bound-box">
            <h3>üíæ I/O-Bound Tasks</h3>
            <h4>Characteristics:</h4>
            <ul>
                <li>File read/write operations</li>
                <li>Network requests (HTTP, API calls)</li>
                <li>Database queries</li>
                <li>User input waiting</li>
                <li>External service calls</li>
            </ul>
            <h4>Thread Strategy:</h4>
            <p><strong>Optimal: 2-4x CPU cores</strong></p>
            <p>While threads wait for I/O, others can work</p>
            <p>Example: 4 cores = 8-16 threads</p>
            <p><em>Max 4 threads running simultaneously</em></p>
        </div>

        <div class="comparison-box context-switch-box">
            <h3>‚ö° Context Switching Overhead</h3>
            <h4>What happens with 200 threads:</h4>
            <ul>
                <li>196 threads waiting in queue</li>
                <li>Constant context switching between threads</li>
                <li>CPU spends more time switching than working</li>
                <li>Memory pressure from thread stacks</li>
                <li>Cache misses increase dramatically</li>
            </ul>
            <h4>Performance Impact:</h4>
            <p><strong>Result: Terrible performance despite full CPU usage</strong></p>
            <p>Context switching overhead can consume 50-90% of CPU time</p>
        </div>
    </div>
</div>

<div class="container">
    <div class="demo-section">
        <h3>üìä Execution Timeline</h3>
        <div id="timelineContainer">
            <div class="timeline">
                <div class="timeline-label">Core 1:</div>
                <div class="time-slots" id="timeline-core1"></div>
            </div>
            <div class="timeline">
                <div class="timeline-label">Core 2:</div>
                <div class="time-slots" id="timeline-core2"></div>
            </div>
            <div class="timeline">
                <div class="timeline-label">Core 3:</div>
                <div class="time-slots" id="timeline-core3"></div>
            </div>
            <div class="timeline">
                <div class="timeline-label">Core 4:</div>
                <div class="time-slots" id="timeline-core4"></div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="explanation">
        <h3>üéØ Thread Selection Guidelines</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div>
                <h4>For CPU-Bound Tasks:</h4>
                <ul>
                    <li><strong>Use 1 thread per core</strong></li>
                    <li>Avoid oversubscription</li>
                    <li>Minimize context switching</li>
                    <li>Example: Runtime.getRuntime().availableProcessors()</li>
                </ul>
            </div>
            <div>
                <h4>For I/O-Bound Tasks:</h4>
                <ul>
                    <li><strong>Use 2-4x CPU cores</strong></li>
                    <li>While one thread waits, others work</li>
                    <li>Monitor thread pool utilization</li>
                    <li>Adjust based on I/O wait times</li>
                </ul>
            </div>
            <div>
                <h4>Avoid Too Many Threads:</h4>
                <ul>
                    <li><strong>200+ threads = Performance disaster</strong></li>
                    <li>More context switching than actual work</li>
                    <li>Memory overhead (each thread = ~1MB stack)</li>
                    <li>Use thread pools with limits</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    let currentDemo = null;
    let demoInterval = null;

    function resetDemo() {
        if (demoInterval) {
            clearInterval(demoInterval);
            demoInterval = null;
        }
        currentDemo = null;

        // Reset all thread slots
        document.querySelectorAll('.thread-slot').forEach((slot, index) => {
            slot.className = 'thread-slot';
            slot.textContent = `T${index + 1}`;
        });

        // Hide thread count display
        document.getElementById('threadCountDisplay').style.display = 'none';

        // Clear timelines
        ['timeline-core1', 'timeline-core2', 'timeline-core3', 'timeline-core4'].forEach(id => {
            document.getElementById(id).innerHTML = '';
        });

        // Reset stats
        updateStats(0, 0, 0, 0, 0, 0);
    }

    function updateStats(running, ready, blocked, cpuUtil, contextSwitches, performance) {
        document.getElementById('runningThreads').textContent = running;
        document.getElementById('readyThreads').textContent = ready;
        document.getElementById('blockedThreads').textContent = blocked;
        document.getElementById('cpuUtilization').textContent = cpuUtil + '%';
        document.getElementById('contextSwitches').textContent = contextSwitches;

        const perfBar = document.getElementById('performanceBar');
        perfBar.style.width = performance + '%';

        if (performance >= 80) {
            perfBar.className = 'performance-bar good-performance';
        } else if (performance >= 50) {
            perfBar.className = 'performance-bar medium-performance';
        } else {
            perfBar.className = 'performance-bar poor-performance';
        }
    }

    function demonstrateCPUBound() {
        resetDemo();
        currentDemo = 'cpu';

        // Show 4 CPU-bound threads (1 per core) - all running
        const coreThreads = ['core1-thread1', 'core2-thread1', 'core3-thread1', 'core4-thread1'];

        coreThreads.forEach((threadId, index) => {
            document.getElementById(threadId).className = 'thread-slot thread-running';
            document.getElementById(threadId).textContent = `CPU-${index + 1}`;
        });

        updateStats(4, 0, 0, 100, 0, 95);

        // Add timeline visualization
        let timeSlot = 0;
        demoInterval = setInterval(() => {
            ['timeline-core1', 'timeline-core2', 'timeline-core3', 'timeline-core4'].forEach((timelineId, coreIndex) => {
                const timeline = document.getElementById(timelineId);
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.textContent = `C${coreIndex + 1}`;
                slot.style.backgroundColor = '#e74c3c';
                slot.style.color = 'white';
                timeline.appendChild(slot);

                if (timeline.children.length > 20) {
                    timeline.removeChild(timeline.firstChild);
                }
            });
            timeSlot++;
        }, 800);
    }

    function demonstrateIOBound() {
        resetDemo();
        currentDemo = 'io';

        // Show 16 I/O-bound threads across all cores
        const allThreads = [];
        for (let core = 1; core <= 4; core++) {
            for (let thread = 1; thread <= 4; thread++) {
                allThreads.push(`core${core}-thread${thread}`);
            }
        }

        let runningCount = 0;
        let readyCount = 0;
        let blockedCount = 0;

        // Simulate I/O operations
        demoInterval = setInterval(() => {
            runningCount = 0;
            readyCount = 0;
            blockedCount = 0;

            // Randomly assign thread states
            const threadStates = [];
            for (let i = 0; i < 16; i++) {
                const rand = Math.random();
                if (rand < 0.25) { // 25% chance running
                    threadStates.push('running');
                } else if (rand < 0.45) { // 20% chance ready
                    threadStates.push('ready');
                } else { // 55% chance blocked (waiting for I/O)
                    threadStates.push('blocked');
                }
            }

            // Ensure max 4 running threads (1 per core)
            let runningAssigned = 0;
            threadStates.forEach((state, index) => {
                if (state === 'running' && runningAssigned < 4) {
                    runningCount++;
                    runningAssigned++;
                } else if (state === 'running') {
                    // Convert excess running to ready
                    threadStates[index] = 'ready';
                    readyCount++;
                } else if (state === 'ready') {
                    readyCount++;
                } else {
                    blockedCount++;
                }
            });

            // Update visual representation
            allThreads.forEach((threadId, index) => {
                const element = document.getElementById(threadId);
                const state = threadStates[index];

                if (state === 'running') {
                    element.className = 'thread-slot thread-running';
                    element.textContent = `Run-${index + 1}`;
                } else if (state === 'ready') {
                    element.className = 'thread-slot thread-ready';
                    element.textContent = `Rdy-${index + 1}`;
                } else {
                    element.className = 'thread-slot thread-blocked';
                    element.textContent = `Blk-${index + 1}`;
                }
            });

            // Calculate CPU utilization correctly (running threads / total cores * 100)
            const cpuUtil = Math.round((runningCount / 4) * 100);
            const performance = Math.min(85, runningCount * 20);
            updateStats(runningCount, readyCount, blockedCount, cpuUtil, 25, performance);

            // Add timeline
            ['timeline-core1', 'timeline-core2', 'timeline-core3', 'timeline-core4'].forEach((timelineId, coreIndex) => {
                const timeline = document.getElementById(timelineId);
                const slot = document.createElement('div');
                slot.className = 'time-slot';

                // Show what's running on this core
                const coreThreadIndex = coreIndex * 4;
                const coreState = threadStates[coreThreadIndex] || 'idle';

                if (coreState === 'running') {
                    slot.textContent = 'RUN';
                    slot.style.backgroundColor = '#e74c3c';
                    slot.style.color = 'white';
                } else if (Math.random() > 0.5) { // Sometimes other threads run
                    slot.textContent = 'RUN';
                    slot.style.backgroundColor = '#e74c3c';
                    slot.style.color = 'white';
                } else {
                    slot.textContent = 'IDL';
                    slot.style.backgroundColor = '#feb2b2';
                    slot.style.color = '#c53030';
                }

                timeline.appendChild(slot);

                if (timeline.children.length > 20) {
                    timeline.removeChild(timeline.firstChild);
                }
            });
        }, 1000);
    }

    function demonstrateContextSwitching() {
        resetDemo();
        currentDemo = 'context';

        // Show thread count display
        document.getElementById('threadCountDisplay').style.display = 'block';
        document.getElementById('totalThreadCount').textContent = 'Total Threads: 200';

        // Show excessive context switching with 200 threads (but only show 16 visually)
        const allThreads = [];
        for (let core = 1; core <= 4; core++) {
            for (let thread = 1; thread <= 4; thread++) {
                allThreads.push(`core${core}-thread${thread}`);
            }
        }

        let switchCount = 0;

        demoInterval = setInterval(() => {
            let runningCount = 4; // Always 4 running (max cores)
            let readyCount = 180; // 180 threads waiting in ready queue
            let blockedCount = 16; // Some blocked for I/O
            let switchingCount = 0;

            // Show visual representation of the chaos
            allThreads.forEach((threadId, index) => {
                const element = document.getElementById(threadId);
                const rand = Math.random();

                if (rand < 0.3) { // 30% chance running
                    element.className = 'thread-slot thread-running';
                    element.textContent = `Run-${Math.floor(Math.random() * 200) + 1}`;
                } else if (rand < 0.7) { // 40% chance context switching
                    element.className = 'thread-slot thread-context-switch';
                    element.textContent = `CS-${Math.floor(Math.random() * 200) + 1}`;
                    switchingCount++;
                } else if (rand < 0.9) { // 20% chance ready
                    element.className = 'thread-slot thread-ready';
                    element.textContent = `Rdy-${Math.floor(Math.random() * 200) + 1}`;
                } else { // 10% chance blocked
                    element.className = 'thread-slot thread-blocked';
                    element.textContent = `Blk-${Math.floor(Math.random() * 200) + 1}`;
                }
            });

            // Massive context switching overhead
            switchCount = Math.min(1000, switchCount + Math.floor(Math.random() * 100) + 50);

            const cpuUtil = 100; // CPU is 100% busy but mostly with context switching
            const performance = Math.max(5, 100 - (switchCount / 10)); // Terrible performance
            updateStats(runningCount, readyCount, blockedCount, cpuUtil, switchCount, performance);

            // Add timeline showing mostly context switching
            ['timeline-core1', 'timeline-core2', 'timeline-core3', 'timeline-core4'].forEach((timelineId, coreIndex) => {
                const timeline = document.getElementById(timelineId);
                const slot = document.createElement('div');
                slot.className = 'time-slot';

                if (Math.random() > 0.2) { // 80% context switching
                    slot.textContent = 'CS';
                    slot.style.backgroundColor = '#f59e0b';
                    slot.style.color = 'white';
                } else { // 20% actual work
                    slot.textContent = 'W';
                    slot.style.backgroundColor = '#e74c3c';
                    slot.style.color = 'white';
                }

                timeline.appendChild(slot);

                if (timeline.children.length > 20) {
                    timeline.removeChild(timeline.firstChild);
                }
            });

            switchCount = Math.max(500, switchCount - 20); // Keep it high
        }, 400);
    }
</script>
</body>
</html>
